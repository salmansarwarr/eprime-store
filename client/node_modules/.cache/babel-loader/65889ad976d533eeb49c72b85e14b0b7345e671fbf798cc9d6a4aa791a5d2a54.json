{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"/home/salman/Documents/GitHub/FakeShop/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/home/salman/Documents/GitHub/FakeShop/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar _get = require(\"/home/salman/Documents/GitHub/FakeShop/node_modules/@babel/runtime/helpers/get.js\").default;\nvar _getPrototypeOf = require(\"/home/salman/Documents/GitHub/FakeShop/node_modules/@babel/runtime/helpers/getPrototypeOf.js\").default;\nvar _inherits = require(\"/home/salman/Documents/GitHub/FakeShop/node_modules/@babel/runtime/helpers/inherits.js\").default;\nvar _createSuper = require(\"/home/salman/Documents/GitHub/FakeShop/node_modules/@babel/runtime/helpers/createSuper.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ValidateCollectionOperation = void 0;\nvar error_1 = require(\"../error\");\nvar command_1 = require(\"./command\");\n/** @internal */\nvar ValidateCollectionOperation = /*#__PURE__*/function (_command_1$CommandOpe) {\n  _inherits(ValidateCollectionOperation, _command_1$CommandOpe);\n  var _super = _createSuper(ValidateCollectionOperation);\n  function ValidateCollectionOperation(admin, collectionName, options) {\n    var _this;\n    _classCallCheck(this, ValidateCollectionOperation);\n    // Decorate command with extra options\n    var command = {\n      validate: collectionName\n    };\n    var keys = Object.keys(options);\n    for (var i = 0; i < keys.length; i++) {\n      if (Object.prototype.hasOwnProperty.call(options, keys[i]) && keys[i] !== 'session') {\n        command[keys[i]] = options[keys[i]];\n      }\n    }\n    _this = _super.call(this, admin.s.db, options);\n    _this.options = options;\n    _this.command = command;\n    _this.collectionName = collectionName;\n    return _this;\n  }\n  _createClass(ValidateCollectionOperation, [{\n    key: \"executeCallback\",\n    value: function executeCallback(server, session, callback) {\n      var collectionName = this.collectionName;\n      _get(_getPrototypeOf(ValidateCollectionOperation.prototype), \"executeCommand\", this).call(this, server, session, this.command, function (err, doc) {\n        if (err != null) return callback(err);\n        // TODO(NODE-3483): Replace these with MongoUnexpectedServerResponseError\n        if (doc.ok === 0) return callback(new error_1.MongoRuntimeError('Error with validate command'));\n        if (doc.result != null && typeof doc.result !== 'string') return callback(new error_1.MongoRuntimeError('Error with validation data'));\n        if (doc.result != null && doc.result.match(/exception|corrupt/) != null) return callback(new error_1.MongoRuntimeError(\"Invalid collection \".concat(collectionName)));\n        if (doc.valid != null && !doc.valid) return callback(new error_1.MongoRuntimeError(\"Invalid collection \".concat(collectionName)));\n        return callback(undefined, doc);\n      });\n    }\n  }]);\n  return ValidateCollectionOperation;\n}(command_1.CommandOperation);\nexports.ValidateCollectionOperation = ValidateCollectionOperation;","map":{"version":3,"names":["error_1","require","command_1","ValidateCollectionOperation","_command_1$CommandOpe","_inherits","_super","_createSuper","admin","collectionName","options","_this","_classCallCheck","command","validate","keys","Object","i","length","prototype","hasOwnProperty","call","s","db","_createClass","key","value","executeCallback","server","session","callback","_get","_getPrototypeOf","err","doc","ok","MongoRuntimeError","result","match","concat","valid","undefined","CommandOperation","exports"],"sources":["/home/salman/Documents/GitHub/FakeShop/node_modules/mongodb/src/operations/validate_collection.ts"],"sourcesContent":["import type { Admin } from '../admin';\nimport type { Document } from '../bson';\nimport { MongoRuntimeError } from '../error';\nimport type { Server } from '../sdam/server';\nimport type { ClientSession } from '../sessions';\nimport type { Callback } from '../utils';\nimport { CommandOperation, type CommandOperationOptions } from './command';\n\n/** @public */\nexport interface ValidateCollectionOptions extends CommandOperationOptions {\n  /** Validates a collection in the background, without interrupting read or write traffic (only in MongoDB 4.4+) */\n  background?: boolean;\n}\n\n/** @internal */\nexport class ValidateCollectionOperation extends CommandOperation<Document> {\n  override options: ValidateCollectionOptions;\n  collectionName: string;\n  command: Document;\n\n  constructor(admin: Admin, collectionName: string, options: ValidateCollectionOptions) {\n    // Decorate command with extra options\n    const command: Document = { validate: collectionName };\n    const keys = Object.keys(options);\n    for (let i = 0; i < keys.length; i++) {\n      if (Object.prototype.hasOwnProperty.call(options, keys[i]) && keys[i] !== 'session') {\n        command[keys[i]] = (options as Document)[keys[i]];\n      }\n    }\n\n    super(admin.s.db, options);\n    this.options = options;\n    this.command = command;\n    this.collectionName = collectionName;\n  }\n\n  override executeCallback(\n    server: Server,\n    session: ClientSession | undefined,\n    callback: Callback<Document>\n  ): void {\n    const collectionName = this.collectionName;\n\n    super.executeCommand(server, session, this.command, (err, doc) => {\n      if (err != null) return callback(err);\n\n      // TODO(NODE-3483): Replace these with MongoUnexpectedServerResponseError\n      if (doc.ok === 0) return callback(new MongoRuntimeError('Error with validate command'));\n      if (doc.result != null && typeof doc.result !== 'string')\n        return callback(new MongoRuntimeError('Error with validation data'));\n      if (doc.result != null && doc.result.match(/exception|corrupt/) != null)\n        return callback(new MongoRuntimeError(`Invalid collection ${collectionName}`));\n      if (doc.valid != null && !doc.valid)\n        return callback(new MongoRuntimeError(`Invalid collection ${collectionName}`));\n\n      return callback(undefined, doc);\n    });\n  }\n}\n"],"mappings":";;;;;;;;;;;;AAEA,IAAAA,OAAA,GAAAC,OAAA;AAIA,IAAAC,SAAA,GAAAD,OAAA;AAQA;AAAA,IACaE,2BAA4B,0BAAAC,qBAAA;EAAAC,SAAA,CAAAF,2BAAA,EAAAC,qBAAA;EAAA,IAAAE,MAAA,GAAAC,YAAA,CAAAJ,2BAAA;EAKvC,SAAAA,4BAAYK,KAAY,EAAEC,cAAsB,EAAEC,OAAkC;IAAA,IAAAC,KAAA;IAAAC,eAAA,OAAAT,2BAAA;IAClF;IACA,IAAMU,OAAO,GAAa;MAAEC,QAAQ,EAAEL;IAAc,CAAE;IACtD,IAAMM,IAAI,GAAGC,MAAM,CAACD,IAAI,CAACL,OAAO,CAAC;IACjC,KAAK,IAAIO,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,IAAI,CAACG,MAAM,EAAED,CAAC,EAAE,EAAE;MACpC,IAAID,MAAM,CAACG,SAAS,CAACC,cAAc,CAACC,IAAI,CAACX,OAAO,EAAEK,IAAI,CAACE,CAAC,CAAC,CAAC,IAAIF,IAAI,CAACE,CAAC,CAAC,KAAK,SAAS,EAAE;QACnFJ,OAAO,CAACE,IAAI,CAACE,CAAC,CAAC,CAAC,GAAIP,OAAoB,CAACK,IAAI,CAACE,CAAC,CAAC,CAAC;;;IAIrDN,KAAA,GAAAL,MAAA,CAAAe,IAAA,OAAMb,KAAK,CAACc,CAAC,CAACC,EAAE,EAAEb,OAAO;IACzBC,KAAA,CAAKD,OAAO,GAAGA,OAAO;IACtBC,KAAA,CAAKE,OAAO,GAAGA,OAAO;IACtBF,KAAA,CAAKF,cAAc,GAAGA,cAAc;IAAC,OAAAE,KAAA;EACvC;EAACa,YAAA,CAAArB,2BAAA;IAAAsB,GAAA;IAAAC,KAAA,EAEQ,SAAAC,gBACPC,MAAc,EACdC,OAAkC,EAClCC,QAA4B;MAE5B,IAAMrB,cAAc,GAAG,IAAI,CAACA,cAAc;MAE1CsB,IAAA,CAAAC,eAAA,CAAA7B,2BAAA,CAAAgB,SAAA,2BAAAE,IAAA,OAAqBO,MAAM,EAAEC,OAAO,EAAE,IAAI,CAAChB,OAAO,EAAE,UAACoB,GAAG,EAAEC,GAAG,EAAI;QAC/D,IAAID,GAAG,IAAI,IAAI,EAAE,OAAOH,QAAQ,CAACG,GAAG,CAAC;QAErC;QACA,IAAIC,GAAG,CAACC,EAAE,KAAK,CAAC,EAAE,OAAOL,QAAQ,CAAC,IAAI9B,OAAA,CAAAoC,iBAAiB,CAAC,6BAA6B,CAAC,CAAC;QACvF,IAAIF,GAAG,CAACG,MAAM,IAAI,IAAI,IAAI,OAAOH,GAAG,CAACG,MAAM,KAAK,QAAQ,EACtD,OAAOP,QAAQ,CAAC,IAAI9B,OAAA,CAAAoC,iBAAiB,CAAC,4BAA4B,CAAC,CAAC;QACtE,IAAIF,GAAG,CAACG,MAAM,IAAI,IAAI,IAAIH,GAAG,CAACG,MAAM,CAACC,KAAK,CAAC,mBAAmB,CAAC,IAAI,IAAI,EACrE,OAAOR,QAAQ,CAAC,IAAI9B,OAAA,CAAAoC,iBAAiB,uBAAAG,MAAA,CAAuB9B,cAAc,CAAE,CAAC,CAAC;QAChF,IAAIyB,GAAG,CAACM,KAAK,IAAI,IAAI,IAAI,CAACN,GAAG,CAACM,KAAK,EACjC,OAAOV,QAAQ,CAAC,IAAI9B,OAAA,CAAAoC,iBAAiB,uBAAAG,MAAA,CAAuB9B,cAAc,CAAE,CAAC,CAAC;QAEhF,OAAOqB,QAAQ,CAACW,SAAS,EAAEP,GAAG,CAAC;MACjC,CAAC;IACH;EAAC;EAAA,OAAA/B,2BAAA;AAAA,EA1C8CD,SAAA,CAAAwC,gBAA0B;AAA3EC,OAAA,CAAAxC,2BAAA,GAAAA,2BAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}