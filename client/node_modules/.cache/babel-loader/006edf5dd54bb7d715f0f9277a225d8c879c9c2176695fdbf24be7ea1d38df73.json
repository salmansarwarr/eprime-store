{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"/home/salman/Documents/GitHub/FakeShop/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/home/salman/Documents/GitHub/FakeShop/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar _get = require(\"/home/salman/Documents/GitHub/FakeShop/node_modules/@babel/runtime/helpers/get.js\").default;\nvar _getPrototypeOf = require(\"/home/salman/Documents/GitHub/FakeShop/node_modules/@babel/runtime/helpers/getPrototypeOf.js\").default;\nvar _inherits = require(\"/home/salman/Documents/GitHub/FakeShop/node_modules/@babel/runtime/helpers/inherits.js\").default;\nvar _createSuper = require(\"/home/salman/Documents/GitHub/FakeShop/node_modules/@babel/runtime/helpers/createSuper.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CountDocumentsOperation = void 0;\nvar aggregate_1 = require(\"./aggregate\");\n/** @internal */\nvar CountDocumentsOperation = /*#__PURE__*/function (_aggregate_1$Aggregat) {\n  _inherits(CountDocumentsOperation, _aggregate_1$Aggregat);\n  var _super = _createSuper(CountDocumentsOperation);\n  function CountDocumentsOperation(collection, query, options) {\n    _classCallCheck(this, CountDocumentsOperation);\n    var pipeline = [];\n    pipeline.push({\n      $match: query\n    });\n    if (typeof options.skip === 'number') {\n      pipeline.push({\n        $skip: options.skip\n      });\n    }\n    if (typeof options.limit === 'number') {\n      pipeline.push({\n        $limit: options.limit\n      });\n    }\n    pipeline.push({\n      $group: {\n        _id: 1,\n        n: {\n          $sum: 1\n        }\n      }\n    });\n    return _super.call(this, collection.s.namespace, pipeline, options);\n  }\n  _createClass(CountDocumentsOperation, [{\n    key: \"executeCallback\",\n    value: function executeCallback(server, session, callback) {\n      _get(_getPrototypeOf(CountDocumentsOperation.prototype), \"executeCallback\", this).call(this, server, session, function (err, result) {\n        if (err || !result) {\n          callback(err);\n          return;\n        }\n        // NOTE: We're avoiding creating a cursor here to reduce the callstack.\n        var response = result;\n        if (response.cursor == null || response.cursor.firstBatch == null) {\n          callback(undefined, 0);\n          return;\n        }\n        var docs = response.cursor.firstBatch;\n        callback(undefined, docs.length ? docs[0].n : 0);\n      });\n    }\n  }]);\n  return CountDocumentsOperation;\n}(aggregate_1.AggregateOperation);\nexports.CountDocumentsOperation = CountDocumentsOperation;","map":{"version":3,"names":["aggregate_1","require","CountDocumentsOperation","_aggregate_1$Aggregat","_inherits","_super","_createSuper","collection","query","options","_classCallCheck","pipeline","push","$match","skip","$skip","limit","$limit","$group","_id","n","$sum","call","s","namespace","_createClass","key","value","executeCallback","server","session","callback","_get","_getPrototypeOf","prototype","err","result","response","cursor","firstBatch","undefined","docs","length","AggregateOperation","exports"],"sources":["/home/salman/Documents/GitHub/FakeShop/node_modules/mongodb/src/operations/count_documents.ts"],"sourcesContent":["import type { Document } from '../bson';\nimport type { Collection } from '../collection';\nimport type { Server } from '../sdam/server';\nimport type { ClientSession } from '../sessions';\nimport type { Callback } from '../utils';\nimport { AggregateOperation, type AggregateOptions } from './aggregate';\n\n/** @public */\nexport interface CountDocumentsOptions extends AggregateOptions {\n  /** The number of documents to skip. */\n  skip?: number;\n  /** The maximum amounts to count before aborting. */\n  limit?: number;\n}\n\n/** @internal */\nexport class CountDocumentsOperation extends AggregateOperation<number> {\n  constructor(collection: Collection, query: Document, options: CountDocumentsOptions) {\n    const pipeline = [];\n    pipeline.push({ $match: query });\n\n    if (typeof options.skip === 'number') {\n      pipeline.push({ $skip: options.skip });\n    }\n\n    if (typeof options.limit === 'number') {\n      pipeline.push({ $limit: options.limit });\n    }\n\n    pipeline.push({ $group: { _id: 1, n: { $sum: 1 } } });\n\n    super(collection.s.namespace, pipeline, options);\n  }\n\n  override executeCallback(\n    server: Server,\n    session: ClientSession | undefined,\n    callback: Callback<number>\n  ): void {\n    super.executeCallback(server, session, (err, result) => {\n      if (err || !result) {\n        callback(err);\n        return;\n      }\n\n      // NOTE: We're avoiding creating a cursor here to reduce the callstack.\n      const response = result as unknown as Document;\n      if (response.cursor == null || response.cursor.firstBatch == null) {\n        callback(undefined, 0);\n        return;\n      }\n\n      const docs = response.cursor.firstBatch;\n      callback(undefined, docs.length ? docs[0].n : 0);\n    });\n  }\n}\n"],"mappings":";;;;;;;;;;;;AAKA,IAAAA,WAAA,GAAAC,OAAA;AAUA;AAAA,IACaC,uBAAwB,0BAAAC,qBAAA;EAAAC,SAAA,CAAAF,uBAAA,EAAAC,qBAAA;EAAA,IAAAE,MAAA,GAAAC,YAAA,CAAAJ,uBAAA;EACnC,SAAAA,wBAAYK,UAAsB,EAAEC,KAAe,EAAEC,OAA8B;IAAAC,eAAA,OAAAR,uBAAA;IACjF,IAAMS,QAAQ,GAAG,EAAE;IACnBA,QAAQ,CAACC,IAAI,CAAC;MAAEC,MAAM,EAAEL;IAAK,CAAE,CAAC;IAEhC,IAAI,OAAOC,OAAO,CAACK,IAAI,KAAK,QAAQ,EAAE;MACpCH,QAAQ,CAACC,IAAI,CAAC;QAAEG,KAAK,EAAEN,OAAO,CAACK;MAAI,CAAE,CAAC;;IAGxC,IAAI,OAAOL,OAAO,CAACO,KAAK,KAAK,QAAQ,EAAE;MACrCL,QAAQ,CAACC,IAAI,CAAC;QAAEK,MAAM,EAAER,OAAO,CAACO;MAAK,CAAE,CAAC;;IAG1CL,QAAQ,CAACC,IAAI,CAAC;MAAEM,MAAM,EAAE;QAAEC,GAAG,EAAE,CAAC;QAAEC,CAAC,EAAE;UAAEC,IAAI,EAAE;QAAC;MAAE;IAAE,CAAE,CAAC;IAAC,OAAAhB,MAAA,CAAAiB,IAAA,OAEhDf,UAAU,CAACgB,CAAC,CAACC,SAAS,EAAEb,QAAQ,EAAEF,OAAO;EACjD;EAACgB,YAAA,CAAAvB,uBAAA;IAAAwB,GAAA;IAAAC,KAAA,EAEQ,SAAAC,gBACPC,MAAc,EACdC,OAAkC,EAClCC,QAA0B;MAE1BC,IAAA,CAAAC,eAAA,CAAA/B,uBAAA,CAAAgC,SAAA,4BAAAZ,IAAA,OAAsBO,MAAM,EAAEC,OAAO,EAAE,UAACK,GAAG,EAAEC,MAAM,EAAI;QACrD,IAAID,GAAG,IAAI,CAACC,MAAM,EAAE;UAClBL,QAAQ,CAACI,GAAG,CAAC;UACb;;QAGF;QACA,IAAME,QAAQ,GAAGD,MAA6B;QAC9C,IAAIC,QAAQ,CAACC,MAAM,IAAI,IAAI,IAAID,QAAQ,CAACC,MAAM,CAACC,UAAU,IAAI,IAAI,EAAE;UACjER,QAAQ,CAACS,SAAS,EAAE,CAAC,CAAC;UACtB;;QAGF,IAAMC,IAAI,GAAGJ,QAAQ,CAACC,MAAM,CAACC,UAAU;QACvCR,QAAQ,CAACS,SAAS,EAAEC,IAAI,CAACC,MAAM,GAAGD,IAAI,CAAC,CAAC,CAAC,CAACrB,CAAC,GAAG,CAAC,CAAC;MAClD,CAAC;IACH;EAAC;EAAA,OAAAlB,uBAAA;AAAA,EAvC0CF,WAAA,CAAA2C,kBAA0B;AAAvEC,OAAA,CAAA1C,uBAAA,GAAAA,uBAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}